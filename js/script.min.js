function keyDownHandler(e){39==e.keyCode?rightPressed=!0:37==e.keyCode?leftPressed=!0:38==e.keyCode?topPressed=!0:40==e.keyCode?bottomPressed=!0:32==e.keyCode&&(spacePressed=!0)}function keyUpHandler(e){39==e.keyCode?rightPressed=!1:37==e.keyCode?leftPressed=!1:38==e.keyCode?topPressed=!1:40==e.keyCode?bottomPressed=!1:32==e.keyCode&&(spacePressed=!1)}function drawBoss(){bossHealth>0&&(ctx.drawImage(boss,bossX,bossY,bossWidth,bossHeight),0>bossY&&(bossY+=1))}function moveBoss(){bossX+=bossSpeed,bossX+bossWidth>=canvas.width?bossSpeed=-bossSpeed:0>=bossX&&(bossSpeed=-bossSpeed)}function drawBossMidLaser(){for(var e=bossMidLasers.length,s=0;e>s;s++)ctx.beginPath(),ctx.rect(bossMidLasers[s][0],bossMidLasers[s][1],1,4),ctx.fillStyle="rgb(86,206,82)",ctx.fill(),ctx.closePath(),bossMidLasers[s][1]>=canvas.height&&bossMidLasers.splice(s,1)}function addBossMidLaser(){if(bossY>=0&&shotBossMidCD>=20){var e=bossX,s=bossY+bossHeight/2-10,t=bossX+10,i=bossY+bossHeight/2,a=bossX+bossWidth-10,r=bossY+bossHeight/2,n=bossX+bossWidth,o=bossY+bossHeight/2-10,g=1,d=[e,s,g],h=[t,i,g],f=[a,r,g],L=[n,o,g];bossMidLasers.push(d),bossMidLasers.push(h),bossMidLasers.push(f),bossMidLasers.push(L),shotBossMidCD=0}}function moveBossMidLaser(){for(var e=bossMidLasers.length,s=0;e>s;s++)bossMidLasers[s][1]+=bossLaserYSpeed}function drawBossLeftLaser(){for(var e=bossLeftLasers.length,s=0;e>s;s++)ctx.beginPath(),ctx.rect(bossLeftLasers[s][0],bossLeftLasers[s][1],2,2),ctx.fillStyle="rgb(86,206,82)",ctx.fill(),ctx.closePath(),bossLeftLasers[s][1]>=canvas.height&&bossLeftLasers.splice(s,1)}function addBossLeftLaser(){if(bossY>=0&&shotBossLeftCD>=20){var e=bossX,s=bossY+bossHeight/2-10,t=bossX+10,i=bossY+bossHeight/2,a=bossX+20,r=bossY+bossHeight/2-20,n=1,o=[e,s,n],g=[t,i,n],d=[a,r,n];bossLeftLasers.push(o),bossLeftLasers.push(g),bossLeftLasers.push(d),shotBossLeftCD=0}}function moveBossLeftLaser(){for(var e=bossLeftLasers.length,s=0;e>s;s++)bossLeftLasers[s][1]+=bossLaserYSpeed,bossLeftLasers[s][0]-=bossLaserXSpeed}function drawBossRightLaser(){for(var e=bossRightLasers.length,s=0;e>s;s++)ctx.beginPath(),ctx.rect(bossRightLasers[s][0],bossRightLasers[s][1],2,2),ctx.fillStyle="rgb(86,206,82)",ctx.fill(),ctx.closePath(),bossRightLasers[s][1]>=canvas.height&&bossRightLasers.splice(s,1)}function addBossRightLaser(){if(bossY>=0&&shotBossRightCD>=20){var e=bossX+bossWidth,s=bossY+bossHeight/2-10,t=bossX+bossWidth-10,i=bossY+bossHeight/2,a=bossX+bossWidth-20,r=bossY+bossHeight/2-20,n=1,o=[e,s,n],g=[t,i,n],d=[a,r,n];bossRightLasers.push(o),bossRightLasers.push(g),bossRightLasers.push(d),shotBossRightCD=0}}function moveBossRightLaser(){for(var e=bossRightLasers.length,s=0;e>s;s++)bossRightLasers[s][1]+=bossLaserYSpeed,bossRightLasers[s][0]+=bossLaserXSpeed}function drawPlayer(){player.drawImage(playerImg,20,0,playerWidth,playerHeight)}function drawLife(){for(var e=1;nbrOfLifes>e;e++)player.drawImage(playerLife,lifeWidth*e-lifeWidth,playerHeight+10,lifeWidth,lifeHeight);1==nbrOfLifes&&player.drawImage(warning,10,playerHeight-20,warningWidth,warningHeight)}function drawPoints(){points.font="25px Arial",points.fillStyle="rgb(141,163,63)",points.fillText("Points: "+pointsX,90,canvas.height-10)}function addBg(){for(var e=1;bgWTimes>=e;e++)for(var s=1;bgHTimes>=s;s++)if(bgArray.length<bgHTimes*bgWTimes){var t=[bgWidth*e-bgWidth,bgHeight*s-2*bgHeight];bgArray.push(t)}}function moveBg(){for(var e=bgArray.length,s=0;e>s;s++)0>bossY&&(bgArray[s][1]<canvas.height?bgArray[s][1]+=1:bgArray[s][1]=-75)}function drawBg(){for(var e=bgArray.length,s=0;e>s;s++)bg.drawImage(bgImg,bgArray[s][0],bgArray[s][1],bgWidth,bgHeight)}function drawLeftTie(){for(var e=tieLeftSquadron.length,s=0;e>s;s++)tieLeftSquadron[s][1]+=1,tieLeftSquadron[s][0]+=1,1==tieLeftSquadron[s][2]&&ctx.drawImage(tieLeft,tieLeftSquadron[s][0],tieLeftSquadron[s][1],tieLeftWidth,tieLeftHeight),tieLeftSquadron[s][1]>=canvas.height&&tieLeftSquadron.splice(s,1)}function addLeftTie(){var e=(canvas.width/5,tieLeftSquadron.length);if(5>e&&bossCondition>pointsX)for(var s=1;5>=s;s++){var t=[-tieLeftWidth*s*2,-100-tieLeftHeight*s,1,1];tieLeftSquadron.push(t)}}function addLeftTLaser(){var e=tieLeftSquadron.length;if(shotLeftTCD>=40)for(var s=0;e>s;s++)if(1==tieLeftSquadron[s][2]){var t=tieLeftSquadron[s][0]+tieLeftWidth/2,i=tieLeftSquadron[s][1]+tieLeftHeight/2,a=1,r=[t,i,a];tieLeftLasers.push(r),shotLeftTCD=0}}function moveLeftTLaser(){for(var e=tieLeftLasers.length,s=0;e>s;s++)tieLeftLasers[s][1]+=2,tieLeftLasers[s][0]+=2}function drawLeftTLaser(){for(var e=tieLeftLasers.length,s=0;e>s;s++)tieLeftLasers[s][1]<canvas.height?(ctx.beginPath(),ctx.rect(tieLeftLasers[s][0],tieLeftLasers[s][1],2,2),ctx.fillStyle="rgb(86,206,82)",ctx.fill(),ctx.closePath()):tieLeftLasers.splice(s,1)}function drawMidTie(){for(var e=tieMidSquadron.length,s=0;e>s;s++)tieMidSquadron[s][1]+=.7,1==tieMidSquadron[s][2]&&ctx.drawImage(tie,tieMidSquadron[s][0],tieMidSquadron[s][1],tieWidth,tieHeight),tieMidSquadron[s][1]>=canvas.height&&tieMidSquadron.splice(s,1)}function addMidTie(){var e=canvas.width/5,s=tieMidSquadron.length;if(5>s&&bossCondition>pointsX)for(var t=1;5>=t;t++){var i=[e*t-1.5*tieWidth,-tieHeight,1,2];tieMidSquadron.push(i)}}function addMidTLaser(){var e=tieMidSquadron.length;if(shotMidTCD>=40)for(var s=0;e>s;s++)if(1==tieMidSquadron[s][2]){var t=tieMidSquadron[s][0]+tieWidth/2,i=tieMidSquadron[s][1]+tieHeight/2,a=1,r=[t,i,a];tieMidLasers.push(r),shotMidTCD=0}}function moveMidTLaser(){for(var e=tieMidLasers.length,s=0;e>s;s++)tieMidLasers[s][1]+=2}function drawMidTLaser(){for(var e=tieMidLasers.length,s=0;e>s;s++)tieMidLasers[s][1]<canvas.height?(ctx.beginPath(),ctx.rect(tieMidLasers[s][0],tieMidLasers[s][1],1,4),ctx.fillStyle="rgb(86,206,82)",ctx.fill(),ctx.closePath()):tieMidLasers.splice(s,1)}function drawRightTie(){for(var e=tieRightSquadron.length,s=0;e>s;s++)tieRightSquadron[s][0]-=.8,tieRightSquadron[s][1]+=.8,1==tieRightSquadron[s][2]&&ctx.drawImage(tieRight,tieRightSquadron[s][0],tieRightSquadron[s][1],tieRightWidth,tieRightHeight),tieRightSquadron[s][1]>=canvas.height&&tieRightSquadron.splice(s,1)}function addRightTie(){var e=(canvas.width/5,tieRightSquadron.length);if(5>e&&bossCondition>pointsX)for(var s=1;5>=s;s++){var t=[canvas.width+tieRightWidth*s*2,-150-tieRightHeight*s,1,3];tieRightSquadron.push(t)}}function addRightTLaser(){var e=tieRightSquadron.length;if(shotRightTCD>=40)for(var s=0;e>s;s++)if(1==tieRightSquadron[s][2]){var t=tieRightSquadron[s][0]+tieWidth/2,i=tieRightSquadron[s][1]+tieHeight/2,a=1,r=[t,i,a];tieRightLasers.push(r),shotRightTCD=0}}function moveRightTLaser(){for(var e=tieRightLasers.length,s=0;e>s;s++)tieRightLasers[s][1]+=2,tieRightLasers[s][0]-=2}function drawRightTLaser(){for(var e=tieRightLasers.length,s=0;e>s;s++)tieRightLasers[s][1]<canvas.height?(ctx.beginPath(),ctx.rect(tieRightLasers[s][0],tieRightLasers[s][1],2,2),ctx.fillStyle="rgb(86,206,82)",ctx.fill(),ctx.closePath()):tieRightLasers.splice(s,1)}function drawXwing(){ctx.drawImage(xWing,xWingX,xWingY,xWingWidth,xWingHeight)}function pressLaser(){spacePressed&&addLaser()}function addLaser(){if(shotCD>=20){if(nbrOfShots%2==0)var e=xWingX;else var e=xWingX+xWingWidth-3;var s=xWingY,t=1,i=[e,s,t];lasersXwing.push(i),nbrOfShots+=1,shotCD=0}}function moveLaser(){for(var e=lasersXwing.length,s=0;e>s;s++)lasersXwing[s][1]-=2}function drawLaser(){for(var e=lasersXwing.length,s=0;e>s;s++)ctx.beginPath(),ctx.rect(lasersXwing[s][0],lasersXwing[s][1],2,4),ctx.fillStyle="red",ctx.fill(),ctx.closePath(),(lasersXwing[s][1]<0||0==lasersXwing[s][2])&&lasersXwing.splice(s,1)}function laserMidCol(){for(var e=lasersXwing.length,s=tieMidSquadron.length,t=0;e>t;t++)for(var i=0;s>i;i++)lasersXwing[t][1]<=tieMidSquadron[i][1]+tieHeight&&1==tieMidSquadron[i][2]&&lasersXwing[t][0]<tieMidSquadron[i][0]+tieWidth&&lasersXwing[t][0]+2>tieMidSquadron[i][0]&&(tieMidSquadron[i][2]=0,lasersXwing.splice(t,1),pointsX+=1)}function laserLeftCol(){for(var e=lasersXwing.length,s=tieLeftSquadron.length,t=0;e>t;t++)for(var i=0;s>i;i++)lasersXwing[t][1]<=tieLeftSquadron[i][1]+tieHeight&&1==tieLeftSquadron[i][2]&&lasersXwing[t][0]<tieLeftSquadron[i][0]+tieWidth&&lasersXwing[t][0]+2>tieLeftSquadron[i][0]&&(tieLeftSquadron[i][2]=0,lasersXwing.splice(t,1),pointsX+=1)}function laserRightCol(){for(var e=lasersXwing.length,s=tieRightSquadron.length,t=0;e>t;t++)for(var i=0;s>i;i++)lasersXwing[t][1]<=tieRightSquadron[i][1]+tieHeight&&1==tieRightSquadron[i][2]&&lasersXwing[t][0]<tieRightSquadron[i][0]+tieWidth&&lasersXwing[t][0]+2>tieRightSquadron[i][0]&&(tieRightSquadron[i][2]=0,lasersXwing.splice(t,1),pointsX+=1)}function laserBossCol(){for(var e=lasersXwing.length,s=0;e>s;s++)lasersXwing[s][1]<=bossY+bossHeight&&lasersXwing[s][0]>=bossX&&lasersXwing[s][0]<=bossX+bossWidth&&(lasersXwing.splice(s,1),bossHealth-=1,0>=bossHealth&&($updateText("You saved galaxy from The Evil Empire!"),$announcement.find("h1").text("Rebel Alliance wins!"),$announcement.find("img").attr("src","css/images/alliance.png"),$announcement.find("button").text("Play again?"),$announcement.show()))}function bossMidLaserCol(){for(var e=bossMidLasers.length,s=0;e>s;s++)bossMidLasers[s][1]>=xWingY&&bossMidLasers[s][1]<=xWingY+xWingHeight&&bossMidLasers[s][0]>xWingX&&bossMidLasers[s][0]<xWingX+xWingWidth&&(nbrOfLifes>1?(bossMidLasers.splice(s,1),nbrOfLifes-=1):($updateText("You got shot down by the Empire Cruiser."),$announcement.show()))}function bossLeftLaserCol(){for(var e=bossLeftLasers.length,s=0;e>s;s++)bossLeftLasers[s][1]>=xWingY&&bossLeftLasers[s][1]<=xWingY+xWingHeight&&bossLeftLasers[s][0]>xWingX&&bossLeftLasers[s][0]<xWingX+xWingWidth&&(nbrOfLifes>1?(bossLeftLasers.splice(s,1),nbrOfLifes-=1):($updateText("You got shot down by the Empire Cruiser."),$announcement.show()))}function bossRightLaserCol(){for(var e=bossRightLasers.length,s=0;e>s;s++)bossRightLasers[s][1]>=xWingY&&bossRightLasers[s][1]<=xWingY+xWingHeight&&bossRightLasers[s][0]>xWingX&&bossRightLasers[s][0]<xWingX+xWingWidth&&(nbrOfLifes>1?(bossRightLasers.splice(s,1),nbrOfLifes-=1):($updateText("You got shot down by the Empire Cruiser."),$announcement.show()))}function tMidLaserCol(){for(var e=tieMidLasers.length,s=0;e>s;s++)tieMidLasers[s][1]>=xWingY&&tieMidLasers[s][1]<=xWingY+xWingHeight&&tieMidLasers[s][0]>xWingX&&tieMidLasers[s][0]<xWingX+xWingWidth&&(nbrOfLifes>1?(tieMidLasers.splice(s,1),nbrOfLifes-=1):($updateText("You got shot down by the Tie Fighter."),$announcement.show()))}function tLeftLaserCol(){for(var e=tieLeftLasers.length,s=0;e>s;s++)tieLeftLasers[s][1]>=xWingY&&tieLeftLasers[s][1]<=xWingY+xWingHeight&&tieLeftLasers[s][0]>xWingX&&tieLeftLasers[s][0]<xWingX+xWingWidth&&(nbrOfLifes>1?(tieLeftLasers.splice(s,1),nbrOfLifes-=1):($updateText("You got shot down by the Tie Fighter."),$announcement.show()))}function tRightLaserCol(){for(var e=tieRightLasers.length,s=0;e>s;s++)tieRightLasers[s][1]>=xWingY&&tieRightLasers[s][1]<=xWingY+xWingHeight&&tieRightLasers[s][0]>xWingX&&tieRightLasers[s][0]<xWingX+xWingWidth&&(nbrOfLifes>1?(tieRightLasers.splice(s,1),nbrOfLifes-=1):($updateText("You got shot down by the Tie Fighter."),$announcement.show()))}function moveXwing(){rightPressed&&canvas.width-xWingWidth>xWingX?xWingX+=3:leftPressed&&xWingX>0?xWingX-=3:topPressed&&xWingY>0?xWingY-=3:bottomPressed&&canvas.height-xWingHeight>xWingY&&(xWingY+=3)}function xWingBossCol(){bossY+bossHeight>=xWingY&&xWingY+xWingHeight>=bossY&&bossX+bossWidth>xWingX&&xWingX+xWingWidth>bossX&&($updateText("You crashed into Empire Cruiser."),$announcement.show())}function xWingMidCol(){for(var e=tieMidSquadron.length,s=0;e>s;s++)xWingY<=tieMidSquadron[s][1]+tieHeight&&xWingY+xWingHeight>=tieMidSquadron[s][1]&&1==tieMidSquadron[s][2]&&xWingX<tieMidSquadron[s][0]+tieWidth&&xWingX+xWingWidth>tieMidSquadron[s][0]&&($updateText("You crashed into the Tie Fighter."),$announcement.show())}function xWingLeftCol(){for(var e=tieLeftSquadron.length,s=0;e>s;s++)xWingY<=tieLeftSquadron[s][1]+tieHeight&&xWingY+xWingHeight>=tieLeftSquadron[s][1]&&1==tieLeftSquadron[s][2]&&xWingX<tieLeftSquadron[s][0]+tieWidth&&xWingX+xWingWidth>tieLeftSquadron[s][0]&&($updateText("You crashed into the Tie Fighter."),$announcement.show())}function xWingRightCol(){for(var e=tieRightSquadron.length,s=0;e>s;s++)xWingY<=tieRightSquadron[s][1]+tieHeight&&xWingY+xWingHeight>=tieRightSquadron[s][1]&&1==tieRightSquadron[s][2]&&xWingX<tieRightSquadron[s][0]+tieWidth&&xWingX+xWingWidth>tieRightSquadron[s][0]&&($updateText("You crashed into the Tie Fighter."),$announcement.show())}function draw(){ctx.clearRect(0,0,canvas.width,canvas.height),player.clearRect(0,0,canvas.width,canvas.height),points.clearRect(0,0,canvas.width,canvas.height),drawPlayer(),drawLife(),drawPoints(),addBg(),drawBg(),moveBg(),xWingMidCol(),xWingLeftCol(),xWingRightCol(),xWingBossCol(),drawXwing(),pointsX>=bossCondition&&(drawBoss(),bossY>=0&&moveBoss(),laserBossCol(),drawBossMidLaser(),addBossMidLaser(),moveBossMidLaser(),drawBossLeftLaser(),addBossLeftLaser(),moveBossLeftLaser(),drawBossRightLaser(),addBossRightLaser(),moveBossRightLaser()),addLeftTie(),drawLeftTie(),addLeftTLaser(),moveLeftTLaser(),drawLeftTLaser(),addMidTie(),drawMidTie(),addMidTLaser(),moveMidTLaser(),drawMidTLaser(),addRightTie(),drawRightTie(),addRightTLaser(),moveRightTLaser(),drawRightTLaser(),tMidLaserCol(),tLeftLaserCol(),tRightLaserCol(),bossRightLaserCol(),bossMidLaserCol(),bossLeftLaserCol(),moveXwing(),pressLaser(),moveLaser(),drawLaser(),laserMidCol(),laserLeftCol(),laserRightCol(),shotCD+=2,shotMidTCD+=.3,shotLeftTCD+=.2,shotRightTCD+=.2,shotBossMidCD+=.3,shotBossLeftCD+=.5,shotBossRightCD+=.5}function $updateText(e){$announcement.find("p").text(e),clearInterval(drawMe)}var canvas=document.getElementById("myCanvas"),backgroundCanvas=document.getElementById("bgCanvas"),playerCanvas=document.getElementById("playerCanvas"),pointsCanvas=document.getElementById("pointsCanvas"),points=pointsCanvas.getContext("2d"),player=playerCanvas.getContext("2d"),bg=backgroundCanvas.getContext("2d"),ctx=canvas.getContext("2d"),rightPressed=!1,leftPressed=!1,topPressed=!1,bottomPressed=!1,spacePressed=!1,$announcement=$("#announcement"),bossCondition=20,bossHealth=40,bossWidth=45,bossHeight=80,bossX=canvas.width/2-bossWidth/2-10,bossY=-200-bossHeight,bossLaserXSpeed=1,bossLaserYSpeed=.8,bossSpeed=.5,playerWidth=250,playerHeight=85,nbrOfLifes=4,lifeWidth=105,lifeHeight=40,warningWidth=280,warningHeight=100,bgHTimes=3,bgWTimes=3,bgWidth=100,bgHeight=75,squareX=100,squareY=0,squareWidth=50,squareHeight=50,xWingX=120,xWingY=100,xWingWidth=35,xWingHeight=22,nbrOfShots=0,tieX=120,tieY=0,tieWidth=24,tieHeight=24,tieLeftWidth=28,tieLeftHeight=28,tieRightWidth=28,tieRightHeight=28,xWing=new Image;xWing.src="css/images/xwing.png";var tie=new Image;tie.src="css/images/tief.png";var bgImg=new Image;bgImg.src="css/images/bg.jpg";var playerImg=new Image;playerImg.src="css/images/pilot.png";var playerLife=new Image;playerLife.src="css/images/r2d2.png";var warning=new Image;warning.src="css/images/warning.png";var tieLeft=new Image;tieLeft.src="css/images/tief_left.png";var tieRight=new Image;tieRight.src="css/images/tief_right.png";var boss=new Image;boss.src="css/images/cruiser.png",document.addEventListener("keydown",keyDownHandler,!1),document.addEventListener("keyup",keyUpHandler,!1),bossMidLasers=[];var shotBossMidCD=20;bossLeftLasers=[];var shotBossLeftCD=20;bossRightLasers=[];var shotBossRightCD=20,pointsX=0,bgArray=[];tieLeftSquadron=[],tieLeftLasers=[];var shotLeftTCD=40;tieMidSquadron=[],tieMidLasers=[];var shotMidTCD=40;tieRightSquadron=[],tieRightLasers=[];var shotRightTCD=40,lasersXwing=[],shotCD=20;$announcement.find("button").on("click",function(){document.location.reload()});var drawMe=setInterval(draw,15);